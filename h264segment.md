H.264视频切片
=============

项目中采用 HLS 实现直播电视和影视点播，有些时候不需要转码，直接对 MPEGTS 流进行切片处理，最初依据 MPEGTS 流中的 PTS 实现切片，遇到了很多状况。其中比较严重的就是有的 MPEGTS 直播源其 PTS 并不准确，这就造成了切片结果出现问题。

为了避免 PTS 造成切片问题，采用 H.264 原始流中的时间信息作为切片的依据。采用累加每一帧的 duration 进行切片。在H.264中，有两种情况，一种情况是固定帧率，一种可变帧率。针对固定帧率的视频，可以采用帧数乘以每帧 duration 计算分片的长度，帧率可以根据 H.264 基本流中的信息计算出来。对于可变帧率，每一帧都需要计算其 duration。

固定帧率的处理
--------------



可变帧率的处理
--------------

$\Delta t_{fi,dpb}(n) = \Delta t_{o,dpb}(n) \div DeltaTfiDivisor$
